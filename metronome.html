<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <title>metronome</title>
  <meta name="author" content="sembiki.com">
  <meta name="description" content="meemoo.js module for rhythm in bpm or ms" />
  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
  <script src="/meemoo/meemoo.js"></script>
</head>
<body>
  
  
  <input id="bpm" type="number" min="0" max="500" value="120" />
  <label for="bpm">bpm</label>
  =
  <input id="ms" type="number" min="120" value="500" />
  <label for="ms">ms</label>
  
  <button type="button" id="start">start</button>
  <button type="button" id="stop">stop</button>
  
  <script type="text/javascript">
  
  $(document).ready(function() {
    
    var meemoo_bpm, meemoo_ms, loopInterval, setBpm, setMs, setLoop, doLoop, recieveMessage, postMessageToSib;
    
    meemoo_bpm = $("#bpm").val();
    meemoo_ms = $("#ms").val();
    
    $("#bpm").change(function(){
      $meemoo.actions.bpm("/bpm/"+$(this).val());
    });
    
    $("#ms").change(function(){
      $meemoo.actions.ms("/ms/"+$(this).val());
    });
    
    $("#start").click(function(){
      $meemoo.actions.start();
    });
    
    $("#stop").click(function(){
      $meemoo.actions.stop();
    });
    
    $meemoo.actions.bpm = function(message){
      meemoo_bpm = parseInt(message[2]);
      meemoo_ms = parseInt(1000 / meemoo_bpm * 60);
      $("#ms").val(meemoo_ms);
      setLoop(meemoo_ms);
    };
    
    $meemoo.actions.ms = function(message){
      meemoo_ms = parseInt(message[2]);
      meemoo_bpm = parseInt(1000 / meemoo_ms * 60);
      $("#bpm").val(meemoo_bpm);
      setLoop(meemoo_ms);
    };
    
    $meemoo.actions.start = function(message){
      setLoop(meemoo_ms);
    };
    
    $meemoo.actions.stop = function(message){
      clearInterval(loopInterval);
    };
    
    
    setLoop = function(val){
      clearInterval(loopInterval);
      loopInterval = setInterval(doLoop, val);
    };
    
    doLoop = function(){
      $meemoo.send("/beat");
    };
    
    // Todo
    // $meemoo.actions.connect(["","connect",1]);
    
  });
  
  </script>
  
</body>
</html>
