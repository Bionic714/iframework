<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>meemoo/iframework @ GitHub -- iframework proof-of-concept</title>
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/themes/eggplant/jquery-ui.css" rel="stylesheet" type="text/css">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>
</head>
<body>
  
  <iframe src="http://meemoo.github.com/metronome" width="500" height="75"></iframe>
  &rarr;
  <iframe src="http://meemoo.github.com/log" width="300" height="300"></iframe> 
  
  <p id="status">
  </p>
  
  <script type="text/javascript">
    
    var start, count, lastTime;
    
    start = new Date().getTime();
    count = 0;
    
    var postMessageToWindow = function(message, toWindow) {
      // toWindow.postMessage(message, window.location.protocol + "//" + window.location.host);
      toWindow.postMessage(message, "*");
    };
    
    var recieveMessage = function(e) {
      var message = e.data.split("/");
      
      switch (message[1]) {
        case "loaded":
          postMessageToWindow("/name/"+e.source.name, e.source);
          count++;
          break;
        case "forward":
          var windowIndex = parseInt(message[2]);
          if (0 <= windowIndex && windowIndex < window.frames.length) {
            postMessageToWindow(decodeURIComponent(message[3]), window.frames[windowIndex]);
          }
          break;
      }
      
      document.getElementById("status").innerHTML += "<br />" + (new Date().getTime()) +": "+ e.data;
      
    };
    
    window.addEventListener("message", recieveMessage, false);
    
  </script>
  
</body>
</html>