<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>meemoo/iframework @ GitHub -- iframework proof-of-concept</title>
  
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/themes/eggplant/jquery-ui.css" rel="stylesheet" type="text/css">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>
  
  <script src="/meemoo/meemoo.js"></script>
  
  <style type="text/css">
    html, body {
      margin:0;
      padding:0;
      width: 100%;
      height: 100%;
    }
    div.module {
      border: 1px black solid;
      padding: 0 10px 45px 10px;
      display: inline-block;
      background-color: rgba(255,255,255,.75);
/*      box-shadow: 3px 3px 5px rgba(0,0,0,.3);*/
      position: absolute;
      top: 0;
      left: 0;
    }
      div.module h1.title {
        font-size: 20px;
        margin: 0;
        padding: 5px 0;
        cursor: move;
      }
      div.module iframe {
        border: 1px black solid;
        width: 100%;
        height: 100%;
        -webkit-box-sizing: border-box; 
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }
    div.ui-resizable-helper {
      border: 1px black dotted;
      margin: 0 100px 100px 0;
    }
    div.ui-draggable-helper {
      border: 1px black dotted;
      z-index: 1000; /* should just be highest module +1 */
    }
  </style>
</head>
<body>
  
  <svg width="95%" height="95%" style="position:absolute;top:0;left:0;">
    <circle cx="30" cy="235" r="5" fill="none" stroke="black" stroke-width=".9" />
    <circle cx="570" cy="20" r="5" fill="none" stroke="black" stroke-width="1" />
    <path d="M 30 235 L 570 20" stroke="blue" stroke-width="4" />
    <circle cx="30" cy="235" r="2" fill="blue" stroke="none" />
    <circle cx="570" cy="20" r="2" fill="blue" stroke="none" />
  </svg>

  <pre id="status" style="position:absolute;top:400px;"></pre>
  
  <div id="modules">
    <div class="module" style="width:500px;height:75px;top:100px;left:20px;"><h1 class="title">metronome</h1><iframe src="metronome.html"></iframe></div>
    <div class="module" style="width:300px;height:300px;top:30px;left:560px;"><h1 class="title">log</h1><iframe src="log.html"></iframe></div>
  </div>
  
  <script type="text/javascript">
  
  $(document).ready(function(){
    
    // $("div.module").draggable({
    //   // handle: "h1.title",
    //   stack: "div#modules div.module",
    //   helper: function(event){
    //     return $("<div class='ui-draggable-helper'></div>").width( $(this).width()+20 ).height( $(this).height()+40 );
    //   },
    //   // start: function(event, ui){
    //   //   $("div.module").css("z-index", 1);
    //   //   $(event.target).css("z-index", 2);
    //   // },
    //   stop: function(event, ui){
    //     $(event.target).offset({
    //       left: $(ui.helper).offset().left, 
    //       top: $(ui.helper).offset().top
    //     });
    //   }
    // }).resizable({
    //   helper: "ui-resizable-helper"
    // }).disableSelection();
    
  });
  
  
  var start, count, lastTime;
  
  start = new Date().getTime();
  count = 0;
  
  var postMessageToWindow = function(message, toWindow) {
    // toWindow.postMessage(message, window.location.protocol + "//" + window.location.host);
    toWindow.postMessage(message, "*");
  };
  
  var recieveMessage = function(e) {
    var message = e.data.split("/");
    
    switch (message[1]) {
      case "info":
        var info = JSON.parse( decodeURIComponent(message[2]) );
        $("#status").append( JSON.stringify(info) + "<br />" );
        console.log(e.data);
        break;
      case "forward":
        var windowIndex = parseInt(message[2]);
        if (0 <= windowIndex && windowIndex < window.frames.length) {
          postMessageToWindow(decodeURIComponent(message[3]), window.frames[windowIndex]);
        }
        break;
    }
    
  };
  
  window.addEventListener("message", recieveMessage, false);
  
  </script>
  
</body>
</html>